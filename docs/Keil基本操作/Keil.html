<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/6.1.0 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="818"/>

<div>
<span><div style="text-align: center;"><span style="font-weight: bold;">Keil基本操作 </span></div><div style="text-align: center;"><span style="font-size: 10pt;">    文/阿丘  Date:</span></div><div style="text-align: center;"><div><br/></div></div><div style="text-align: center;"><div><br/></div></div><div style="text-align: left;"><span style="font-size: 14pt; font-weight: bold;">一、概述</span></div><div>    工欲善其事必先利其器。Keil uVersion 4.0（后文简称为Keil 4.0）是单片机程序开发的集成开发环境（IDE），集成了C编译器、宏汇编、连接器、库管理和一个功能强大的仿真调试器。</div><div>     本节以点亮一个LED为例，演示如何通过Keil新建工程、添加源文件、编译等基本操作。</div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">二、Keil基本操作</span><span style="font-size: 18.6667px;">——以点亮一个LED项目为例</span></div><div><span style="font-size: 18.6667px;">     本项目通过8051单片机的P2.0管脚控制一个红色LED， 支持两种控制模式：长亮模式和闪烁模式。电路图如下图所示，由图可知，P3.0输出低电平时，LED点亮；输出低电平时，LED熄灭。</span></div><div><img src="Keil_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 18.6667px;">      项目程序由一个.c和一个.h组成，其中，LedCtrl.c为主程序，演示LED的两种控制模式；led.h为LED控制实现，定义了长亮函数lit(bit flag)、闪烁函数flash(unsigned int interval)和软件延时函数delayMS(unsigned int ms)。</span></div><div><span style="font-size: 18.6667px;">      下面演示基于Keil完成本项目的开发过程。</span></div><div><span style="font-size: 18.6667px;">        1. 新建工程。</span></div><div><span style="font-size: 18.6667px;">        （1） 运行Keil uVision4。</span></div><div><span style="font-size: 18.6667px;">        （2）选择菜单【Project&gt;New μVersion Project】，打开Create New Project对话框。</span></div><div><span style="font-size: 18.6667px;">          <img src="Keil_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><br/></div><div>         （3）设置工程保存路径和工程名称。注意，建议一个工程对应一个文件夹，方便管理。 </div><div>          <img src="Keil_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>    （4）设置单片机型号。 在Select a CPU Data Base File对话框选择Generic Data Base，然后弹出的对话框中选择ATMEL&gt;AT89C51，单击【OK】按钮。</div><div><img src="Keil_files/Image [3].png" type="image/png" data-filename="Image.png"/><img src="Keil_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>      （5）单击【否 】按钮，选择不复制8051启动代码到工作文件。</div><div>    <img src="Keil_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div> </div><div>   到此，空白工程已经建好，如下图所示。</div><div><img src="Keil_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><ol start="2"><li><span style="font-size: 14pt;"> 编写代码</span></li></ol><div><span style="font-size: 18.6667px;">   （1）选择菜单【File&gt;New】（快捷键Ctrl+N）新建一个空白文件，则进入文件编辑状态。</span></div></div><div><span style="font-size: 18.6667px;">   （2）选择菜单【File&gt;Save As】（快捷键Ctrl+S）将新建文件存储到工程目录LEDCtrl下，命名为led.h。</span></div><div><span style="font-size: 18.6667px;">   （3）重复步骤（1）~（2），新建</span><span style="font-size: 18.6667px;">文件</span><span style="font-size: 18.6667px;">LedCtrl</span> <span style="font-size: 18.6667px;">.c，存储路径为工程目录<span style="font-size: 18.6667px;">LEDCtrl</span> 下。</span></div><div><span style="font-size: 18.6667px;">   （4）编写led.h，代码如下：</span></div><div><span style="font-size: 18.6667px;">    </span><br/></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#include &lt;reg51.h&gt;   //导入8051特殊功能寄存器定义及其可寻址位定义</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">sbit led_red = P3^0; //定义led_red变量控制P3.0引脚:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                     //输出0时（低电平），LED亮，输出1时，LED灭。</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/******************************</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*函数：LED_lit</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*功能：点亮/熄灭led_red</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*参数：bit flag: flag = 1, 点亮；flag = 0，熄灭</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*返回：无</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*****************************/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">void LED_lit(bit flag)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   led_red = ~flag;  //不用if语句，控制输出与flag为相反，直接取反操作即可。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/******************************</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*函数：delayMS</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*功能：ms级延时函数@12MHz晶振</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*参数：unsigned int: 延时时间，单位ms</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*返回：无</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*****************************/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">void LED_delayMS(unsigned int ms)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   unsigned int i,j;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   for(i=0;i&lt;ms;i++)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     for(j=0;j&lt;150;j++);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/******************************</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*函数：LED_flash</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*功能：led_red闪烁:亮-&gt;灭&gt;亮&gt;灭...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*参数：unsigned int: 闪烁间隔，单位ms</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*返回：无</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*****************************/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">void LED_flash(unsigned int interval)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   lit(1);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   delayMS(interval);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   lit(0);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   delayMS(interval);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><br/></div><div><br/></div><div><span style="font-size: 18.6667px;">    （5）编写LEDCtrl.c，代码如下：</span></div><div><span style="font-size: 18.6667px;">     </span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">#include &quot;led.h&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/******************************</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*函数：main</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*功能：程序入口，演示：1. LED长亮10s； 2. LED闪烁10次.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*参数：无</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*返回：无</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">*****************************/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">void main()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  unsigned char flash_times = 10;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  unsigned char i;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  while(1)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      LED_lit(1);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      LED_delayMS(10000);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      for(i=0;i&lt;flash_times;i++)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          LED_flash(1000);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }  </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><span style="font-size: 18.6667px;"> （6）添加LEDCtrl.c和led.h到当前工程。</span></div><div><span style="font-size: 18.6667px;">   a. 在工程浏览区双击Target 1下的Source Group1，打开添加对话框。 </span></div><div><img src="Keil_files/Image [7].png" type="image/png" data-filename="Image.png"/>  </div><div>b. 再添加对话框中先选择文件类型（.h或.c），再双击要添加的文件即可。</div><div><img src="Keil_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>添加的文件会出现在工程资源浏览区下，如下图所示。</div><div><img src="Keil_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><ol start="3"><li>编译程序。 </li></ol><div>   （1）设置输出.hex选项，输出目录默认为工程路径的根目录。</div></div><div>      选择菜单【Project&gt;Options for Target 'Target1'...】（快捷键ALT+F7或快捷图标<img src="Keil_files/Image [10].png" type="image/png" data-filename="Image.png"/>），在弹出的对话框的Output页签中勾选Create Hex File选项，单击【OK 】按钮。。</div><div><img src="Keil_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>   （2）单击工具栏的快捷图标<img src="Keil_files/Image [12].png" type="image/png" data-filename="Image.png"/>或按快捷键F7，编译程序。</div><div>在编译信息输出区域显示编译结果，如下图所示。</div><div><img src="Keil_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 18.6667px;">    若有错误（error），双击错误提示即可。</span></div><div><span style="font-size: 18.6667px;">    如将LEDCtrl.c里的LED_lit函数调用改为lit，则错误提示如下，表示lit函数缺少原型，即没有定义ing。</span></div><div><span style="font-size: 18.6667px;">    <img src="Keil_files/Image [14].png" type="image/png" data-filename="Image.png"/></span></div><div>至此，整个工程从创建到编译已经介绍完成，以上就是Keil最基本的操作。</div><div>至于程序调试功能，属于高级功能，本文不作介绍。</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 